-----FIT-------------------------------------------------------
 
FIT
 
Name:
    ... FIT
 
Type:
    Analysis Command
 
Purpose:
    Estimate the parameters for a linear, polynomial, or non-linear
    least squares fit (this is one of Dataplot's most powerful and
    heavily used commands).
 
Description:
    The FIT command can be used for both linear or non-linear fits.
    Both weighted and unweighted fits are supported.

    Non-linear fits are performed using an iterative modified
    Levenberg-Marquardt algorithm (Dataplot implements the algorithm
    given in the Osborne paper listed in the References section below).
    This algorithm can fit linear and multi-linear models as well as
    non-linear models.

    In addition, the FIT command can perform linear and polynomoal fits
    using an exact algorithm.  Since the exact algorithm supports a much
    broader range of output, this will be documented separately,  Enter

        HELP LINEAR FIT

    for the documentation for exact linear fits.

    Non-linear fits are specified by entering a function.  For example,

        FIT Y = A0 + A1*X1
        FIT Y = A0 + A1*EXP(A2*(YEAR-1950)
        FIT Y = (A0 + A1*X)/(1 + B1*X)

    The function can either be given on the FIT command or be defined
    with a LET FUNCTION command.

    For non-linear fits, the FIT command generates the following output.

    1) The parameter estimates and associated standard deviations are
       printed for each iteration.

    2) After convergence, a table containing the parameter estimates, the
       parameter standard deviations, and the parameter t-values is
       printed.  The t-value is used to determine if a given paramater is
       statistically significant.

       These values are also written to the file dpst1f.dat.  To read
       these values into Dataplot variables, enter the command

            READ DPST1F.DAT COEF COEFSD TVAL

    3) The correlation matrix for the parameter estimates is written to
       the file dpst2f.dat.  To read this correlation matrix, enter the
       command

            READ MATRIX DPST2F.DAT CORR

    4) The variance-covariance matrix for the parameter estimates is
       written to the file dpst3f.dat.  To read this covariance matrix,
       enter the command

            READ MATRIX DPST3F.DAT COV

    5) The residual standard deviation and its corresponding degrees of
       freedom are are stored in the parameters RESSD and RESDF,
       respectively.  RESDF is the number of observations minus the
       number of independent variables in the fit (including the
       constant term).  The formula for RESSD is:

            RESSD = SQRT(SUM(Y - PREDICTED VALUE)**2)/RESDF)

    6) If there is replication in the independent variables, the
       replication standard deviation and corresponding degrees of
       freedom are printed.  In addition, a lack of fit F test is
       performed.  These are stored in the parameters REPDF, REPSD, and
       LOFCDF respectively.  The formulas are:

             REPDF = SUM(number of observations in replication - 1)
             REPSD = SQRT(SUM((Y - replication mean)**2)/REPDF)
 
    7) Dataplot saves the predicted values from a fit in the variable
       PRED and the residual values in the variable RES.  These variables
       can be used in subsequent LET and PLOT commands to generate
       diagnostic plots of residuals and predicted values.
 
    It is recommended that a FIT be followed by a residual analysis to
    assess the model adequacy.  Specifically, the typical assumptions for
    the residuals are that they are independent with a common
    distribution having fixed location and variation.  It is usually
    assumed that the common distribution is a normal distribution.
    The 4-PLOT command generates 4 plots that are useful in testing
    these assumptions.  The NIST/SEMATECH e-Handbook contains a
    more detailed discussion of this issue at

        https://www.itl.nist.gov/div898/handbook/eda/section2/eda2.htm

    In addition, if there is a single independent variable in the model,
    it can be useful to plot the data with the fitted values overlaid.

    For non-linear fits, up to 15 indepedent variables can be
    included in the model.

Syntax:
    FIT  <y1>  =  <f>  <SUBSET/EXCEPT/FOR qualification>
    where <y1> is the response (= dependent) variable;
          <f> is:
               1) a general Fortran-like expression; or
               2) any function name that the user has already created
                  via the LET FUNCTION command;
    and where the <SUBSET/EXCEPT/FOR qualification> is optional.
 
    This first syntax is appropriate for all models--linear,
    polynomial, multi-linear (up to 15 independent variables), and
    non-linear (up to 15 independent variables).  It uses an iterative
    modified Levenberg-Marquardt algorithm.  Linear fits are handled as
    a special case (the fits are still done iteratively).  Only the
    file DPST1F.DAT is created.
 
Examples:
    FIT Y = A+B*EXP(-C*X)
    FIT Y = A*(EXP(-B*TIME/10) - EXP(-TIME/10))
    FIT Y = B0 + B1*X**B2
    FIT Y = K/(1+K*A*X**B)
    FIT Y = A - B*X - ATAN(C/(X-D))/3.1459
    FIT Y = A0*BESS0(A1*X)*BESS1(A1*X)
    FIT Y = (A0 + A1*X)/(1 + B1*X + B2*X**2)
    FIT Y = (A+B*X+C*X**D)/(SIN(EXP(-ALPHA*X2+BETA*X3)))

    FIT Y = F1

Note:
    The following document contains a number of examples of the
    Dataplot FIT command

    https://www.itl.nist.gov/div898/software/dataplot/NonLinearFitting.pdf

Note:
    The non-linear algorithm is iterative with two commands for
    controlling the iterations.

    By default, a maximum of 50 iterations are allowed before Dataplot
    assumes the fit is not converging.  You can change this maximum with
    the FIT ITERATIONS command.

    Dataplot checks for convergence by computing the ratio of sccuessive
    values of the residual standard deviation.  You can specify the
    critierion for convergence with the FIT STANDARD DEVIATION command.

Note:
    Starting values are not required.  The Levenberg-Marquardt algorithm
    can provide good fits for a wide variety of applications without
    decent starting values.

    However, decent starting values can often speed up non-linear fits.
    In addition, some fits may require good starting values in order
    to converge to accurate values.

    To specify starting values, simply assign values to the coefficients
    before doing the fit.  For example:

       LET ALPHA = 0.15
       LET A = 0.004
       LET B = 0.01
       FIT Y = EXP(-ALPHA*X)/(A+B*X)

    In some cases, good starting values might be known from previous
    work or from theoretical considerations.  However, if better
    starting values are needed and reasonable guesses are not available,
    the PRE-FIT command can be helpful.  Enter HELP PRE-FIT for details.

    Sinusoidal models are one case where good starting values are
    needed.  See the following example from the NIST/SEMATECH e-Handbook
    for an example of fitting this kind of model

        https://www.itl.nist.gov/div898/handbook/eda/section4/eda425.htm

    If you have a parameter in the model that you want to set to a fixed
    value, then enter the literal value or use the substitution
    character "^".  For example

        FIT Y = A0 + A1*X**1.5

        LET C = 1.5
        FIT Y = A0 + A1*X**C   - Dataplot will try to fit C
        FIT Y = A0 + A1*X**^C  - Dataplot will leave C fixed at 1.5

Note:
    Weighted fits are typically used in the following two situations.

       1. Weighting is one approach for dealing with non-constant
          variation in the residuals.  It is not uncommon for the
          variance of the residuals to increase for the largest (or
          smallest) values of the independent variable.  In this case,
          weights can be used to give less weight to the less precise
          measurements.  The NIST/SEMATECH e-Handbook contains a
          disucssion of weighted fits and an example of using weights
          to address non-constant variation in the following pages

          https://www.itl.nist.gov/div898/handbook/pmd/section4/pmd432.htm
          https://www.itl.nist.gov/div898/handbook/pmd/section6/pmd625.htm

       2. Weights can also used to implement certain types of robust
          fitting.  In this case, weights are used to down weight
          observations based on the size of the associated residual.
          Outlier observations can sometimes distort a fit (i.e., in
          trying to fit the outlier point(s), the bulk of the data
          is poorly fit).  Weighting based on the residuals can often
          provide a good fit to the bulk of the data without eliminating
          the outlier observations from the analysis.

          Enter HELP WEIGHTS and HELP BIWEIGHT for examples of this
          use of weighted fits in Dataplot.

    To specify weights for a least squares fit, enter the command

         WEIGHTS <var>

    where <var> is a variable containing the weights.

Note:
    Although the FIT command is the Dataplot workhorse command
    for fitting, Dataplot supports the additional fit capabilities:

       1. ARMA - This command is used for fitting autoregressive/moving
          average time series models.
       2. BOOTSTRAP FIT - This command is used to fit linear or
          multilinear models using the bootstrap.
       3. CALIBRATION - This command is used to fit linear or quadratic
          calibration models
       4. EXACT RATIONAL FIT - This command is used to determine good
          starting values for fitting rational function models (the
          full model is still fit using the FIT command).

          Rational function models are the ratio of two polynomial
          functions.  The NIST/SEMATECH e-Handbook contains a detailed
          discussion of these models at

          https://www.itl.nist.gov/div898/handbook/pmd/section8/pmd812.htm

       6. INTERPOLATION - This LET subcommand performs cubic spline
          interpolation.
       7. HERMITE INTERPOLATION - This LET subcommand performs Hermite
          interpolation.
       8. LOWESS SMOOTH - This command is used to fit locally-weighted
          least squares models.
       9. ORTHOGONAL DISTANCE FIT - This command is used to fit
          errors-in-variables models for for both linear and non-linear
          models.  It can also fit implicit models.
      10. PRINCIPAL COMPONENTS - This LET subcommand can be used to
          reduce the number of indpendent variables in a multi-linear fit.
      11. SMOOTH - This command is used for various types of smoothing.
      12. SPLINE FIT - This command is used for spline fits.
      13. YATES ANALYSIS - This command is used to fit full and fractional
          2-level designs.

    These commands are documented separately.

Note:
    If you want to suppress the output to files dpst1f.dat, dpst2f.dat,
    and dpst3f.dat, enter the command

        SET FIT AUXILLARY FILES OFF

Default:
    None

Synonyms:
    None
 
Related Commands:
    FIT ITERATIONS     = Sets the maximum number of iterations for the
                         FIT command.
    FIT STANDARD DEVI  = Sets the minimum standard deviation for the
                         convergence criterion in the FIT command.
    PRED               = A variable where predicted values are stored.
    RES                = A variable where residuals are stored.
    RESSD              = A parameter where the residual standard
                         deviation is stored.
    RESDF              = A parameter where the residual degrees of
                         freedom is stored.
    REPSD              = A parameter where the replication standard
                         deviation is stored.
    REPDF              = A parameter where the replication degrees of
                         freedom is stored.
    LOFCDF             = A parameter where the lack of fit cdf is
                         stored.
    WEIGHTS            = Sets the weights for the fit command.
    BIWEIGHT           = Perform a biweight transformation.
    EXACT RATIONAL FIT = Perform an exact rational fit.
    CALIBRATION        = Perform a linear or quadratic calibration fit.
    LOWESS SMOOTH      = Perform a locally weighted least squares
                         smoothing.
    BOOTSTRAP FIT      = Perform a linear or multi-linear fit based on
                         the bootstrap.
    ORTHOGON DIST FIT  = Perform an orthogonal distance fit (useful for
                         errors-in-variables models).
    PRE-FIT            = Perform a least squares pre-fit.
    SPLINE FIT         = Perform a spline fit.
    SMOOTH             = Perform a smoothing.
    ANOVA              = Perform a fixed effects analysis of variance.
    MEDIAN POLISH      = Perform a median polish.
    PLOT               = Generate a data/function plot.
    4-PLOT             = Generate a 4-plot.
 
References:
    Osborne (1972), "Some Aspects of Nonlinear Least Squares
    Calculation", in Numerical Methods for Nonlinear Optimization,
    Ed. Lootsma, Academic Press.

    Osborne (1976), "Nonlinear Least Squares -- the Levenberg Algorithm
    Revisited", ANZIAM Journal, Vol. 19, No. 3, pp. 343-357.

Applications:
    Least Squares Fitting
 
Implementation Date:
    Pre-1987
    1987/09: Support for weighted fits
    1988/03: Save LOFCDF parameter
    1991/09: Expand number of allowed independent variables from 15 to 5
    1992/03: Write coefficient, coefficient sd, and t-value to dpst1f.dat
    1992/03: Write coefficient, coefficient sd, and t-value to dpst1f.dat
    1997/07: Print summary information if maximum iterations reached
    2001/04: Print parameter covariance matrix to dpst3f.dat
    2014/06: Option to suppress output to auxillary files

Program 1:
    . Step 1:   Read the data
    .
    SKIP 25
    READ CHWIRUT1.DAT Y X
    SKIP 0
    .
    . Step 2:   Perform the fit
    .
    SET WRITE DECIMALS 5
    LET ALPHA = 0.15
    LET A = 0.004
    LET B = 0.01
    CAPTURE SCREEN ON
    CAPTURE FIT1.OUT
    FIT Y = EXP(-ALPHA*X)/(A+B*X)
    END OF CAPTURE
    .
    . Step 3:   Generate diagonistic graphs
    .
    TITLE OFFSET 2
    TITLE CASE ASIS
    LABEL CASE ASIS
    TITLE Predicted Values Overlaid on Raw Data (CHWIRUT1.DAT)
    X1LABEL Metal Distance
    Y1LABEL Ultrasonic Response
    .
    LINE BLANK SOLID
    CHARACTER X BLANK
    .
    PLOT Y PRED VS X
    .
    LABEL
    TITLE
    SET 4-PLOT MULTIPLOT ON
    MULTIPLOT CORNER COORDINATES 0 0 100 100
    TIC MARK LABEL SIZE 4
    CHARACTER SIZE 4
    .
    4-PLOT RES
    .
    JUSTIFICATION CENTER
    MOVE 50 97
    TEXT 4-Plot of Residuals (CHWIRUT1.DAT)

Program 2:
    . Step 1:   Read the data
    .
    READ ROSZMAN1.DAT X T
    LET Q = X - SQRT(-109737.3/T)
    .
    . Step 2:   Perform the fit
    .
    SET WRITE DECIMALS 5
    LET A = 0.2
    LET B = -0.00005
    LET C = 200
    LET D = -123
    .
    CAPTURE SCREEN ON
    CAPTURE FIT2.OUT
    FIT Q = A - B*T - ATAN(C/(T-D))/3.14159
    END OF CAPTURE
    .
    . Step 3:   Generate diagonistic graphs
    .
    TITLE OFFSET 2
    TITLE CASE ASIS
    LABEL CASE ASIS
    TITLE Predicted Values Overlaid on Raw Data (ROSZMAN1.DAT)
    X1LABEL Excited State Energy
    Y1LABEL Quantum Effects for Sulfur I Atom
    .
    LINE BLANK SOLID
    CHARACTER X BLANK
    .
    PLOT Q PRED VS T
    .
    LABEL
    TITLE
    SET 4-PLOT MULTIPLOT ON
    MULTIPLOT CORNER COORDINATES 0 0 100 100
    TIC MARK LABEL SIZE 4
    CHARACTER SIZE 4
    .
    4-PLOT RES
    .
    JUSTIFICATION CENTER
    MOVE 50 97
    TEXT 4-Plot of Residuals (ROSZMAN1.DAT)
 
